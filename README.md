# Pen Pal

[![Unit Tests](https://github.com/jladdjr/penpal-otp/actions/workflows/python-app.yaml/badge.svg)](https://github.com/jladdjr/penpal-otp/actions/workflows/python-app.yaml)

<img src="./images/writing-a-letter.webp" alt="Writing a letter" width="300"/>

> [!NOTE]
> Pen Pal is still in development. This README describes the app's future behavior.

Pen Pal lets you send and receive messages encrypted using a
[One-time Pad](https://en.wikipedia.org/wiki/One-time_pad).

## Installation

### Requirements

TODO: tar should be installed
TODO: register python package so that it can be pip-installed

## Core concepts and caveats

> [!CAUTION]
> One-time Pads are only as secure as the quality and secrecy of the pad.
> Please see Pen Pal's [disclaimer](./DISCLAIMER.md).

The One-time pad is a powerful form of encryption -- offering the possibility of
[perfect secrecy](https://en.wikipedia.org/wiki/One-time_pad#Perfect_secrecy).
Even so, the system also comes with a number of limitations and
can easily be broken if [mishandled](https://en.wikipedia.org/wiki/One-time_pad#Problems).

A one-time pad (or key) is a string of random characters that are paired
character-by-character with a plaintext message.
If the key is truly random, then there is no way to guess
the original value of any given character that is encrypted.
Hence, perfect secrecy.

The above "if" is a big one.
Generating a truly random sequence of characters
(technically, binary digits) is not trivial.
Pen Pal relies on random strings
[generated by the operating system](https://docs.python.org/3/library/os.html#os.urandom).
Techniques for enhancing the quality of the operating system's
[pseudorandom number generator](https://en.wikipedia.org/wiki/Pseudorandom_number_generator) exist,
but are outside of the scope of general use of Pen Pal.

Even if a perfectly random one-time pad is created,
the pad becomes useless if it is known to anyone other than
the owner and intended recipient of the message.
Therefore it is _critical_ that the one-time pad be shared by a secure means
and guarded against unintended access.
Put differently, the security of a message encrypted using a one-time pad
is only as strong as the degree to which the one-time pad itself is protected.

Pen Pal attempts to preserve the secrecy of the one-time pad by:
- insisting that the Pad's operating system access is set to user-only
- immediately deleting any portion of the pad after it has been used to encrypt or decrypt a message
- encrypting the pad at rest using a user password

These precautions are no substitute for taking every precaution possible to protect the pad however.

*Pen Pal, by itself, cannot guarantee the cryptographic quality or confidentiality of the one-time pad it creates.*

## Pad specification

Pen Pal can create and maintain a One-time Pad for users.

A Pen Pal pad is a directory that includes:
- a `metadata` file
- a `blocks` folder containing a set of _block files_

By convention, the name of a pad directory ends in `.pad`.

The `metadata` file contains metadata for the pad and looks something like:

```yaml
- name: "Alice One-time pad"
- description: "One-time pad for corresponding with Bob"
- created: "2024-09-15"
```

The `blocks` folder contains a set of files containing
[cryptographically secure random numbers](https://cryptography.io/en/latest/random-numbers/#random-number-generation).

### Blocks

Each block file has a [uuid](https://docs.python.org/3/library/uuid.html)-based filename,
such as `9969a58f-35eb-492d-902b-50d41e78838f`.

Each block file consists of [pseudo-random data](https://en.wikipedia.org/wiki//dev/random).
Block files can be different sizes.

## Message Specification

A Pen Pal Message consists of:
- a `blocks` file
- a `message` file

The `blocks` file contains a list of uuid strings separated by newlines.
The uuids represent the blocks needed to decrypt the message.

The `message` file is a binary file representing the encrypted content.

A message is packaged as a [tar](https://www.man7.org/linux/man-pages/man1/tar.1.html) archive that contains the above files (without any directory structure).

### Message length

The exact message length -- that is, the size of the encrypted message in bytes --
is treated like a secret.

The length of the message is given in the first block of encrypted data.

## Decrypted Message specification

Decrypting a `message` will always return a tar archive.
Packaging the message as an archive allows for metadata about the encrypted file(s)
(such as names, extensions, creation and modification timestamps, ownership, etc)
to be preserved.

The encrypted content could be a simple plaintext file,
but could also be an arbitrary file or collection of files.

## Sending and receiving messages

After a user builds a Pen Pal Pad and
[_securely_ delivers](https://en.wikipedia.org/wiki/One-time_pad#Key_distribution) the Pad to another user,
the two users are able to exchange encrypted messages.

When a Pad is used to encrypt or decrypt a message, the associated Pad data is _immediately_ destroyed
as a precaution against being [reused](https://en.wikipedia.org/wiki/Venona_project#Decryption).

### Credits

Image at top generated by AI using OpenAI's DALL-E.
